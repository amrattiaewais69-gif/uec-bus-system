<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>UEC University Bus System</title>
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{
margin:0;
font-family:'Segoe UI',sans-serif;
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
color:#fff;
text-align:center;
overflow-x:hidden;
}

/* Splash */
#splash{
position:fixed;
width:100%;
height:100%;
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
display:flex;
justify-content:center;
align-items:center;
z-index:9999;
animation:fadeOut 1.5s ease forwards;
animation-delay:2.5s;
}
.splash-content{
color:#d4af37;
animation:zoomIn 1.5s ease;
}
@keyframes zoomIn{
0%{transform:scale(0.7);opacity:0;}
100%{transform:scale(1);opacity:1;}
}
@keyframes fadeOut{
to{opacity:0;visibility:hidden;}
}

/* Header */
.header{
padding:20px;
font-size:28px;
font-weight:bold;
color:#d4af37;
}

/* Bus Animation */
.bus-container{
position:relative;
height:160px;
overflow:hidden;
}
.road{
position:absolute;
bottom:40px;
width:100%;
height:6px;
background:linear-gradient(to right,#d4af37 50%,transparent 50%);
background-size:30px 6px;
animation:roadMove 1s linear infinite;
}
@keyframes roadMove{
0%{background-position:0 0;}
100%{background-position:30px 0;}
}
.bus{
position:absolute;
bottom:50px;
animation:busMove 8s linear infinite;
filter:drop-shadow(0 0 20px #d4af37);
}
@keyframes busMove{
0%{left:-250px;}
100%{left:110%;}
}

/* Card */
.card{
width:90%;
max-width:420px;
margin:20px auto;
background:rgba(0,0,0,0.6);
border-radius:20px;
padding:25px;
box-shadow:0 0 25px rgba(212,175,55,0.4);
backdrop-filter:blur(10px);
}

input{
width:90%;
padding:12px;
margin:10px 0;
border-radius:8px;
border:none;
}

button{
background:#d4af37;
border:none;
padding:12px 25px;
border-radius:10px;
font-weight:bold;
cursor:pointer;
transition:0.3s;
}
button:hover{transform:scale(1.05);}

#counter{
margin-top:15px;
font-weight:bold;
color:#d4af37;
}

/* Status Box */
#statusBox{
margin-top:15px;
padding:15px;
border-radius:12px;
font-weight:bold;
min-height:50px;
transition:0.3s;
}

.processing{
background:rgba(212,175,55,0.15);
color:#d4af37;
}

.success{
background:rgba(0,200,0,0.15);
color:#00ff88;
animation:pop 0.3s ease;
}

.error{
background:rgba(255,0,0,0.15);
color:#ff4d4d;
animation:shake 0.3s ease;
}

@keyframes pop{
0%{transform:scale(0.9);}
100%{transform:scale(1);}
}

@keyframes shake{
0%,100%{transform:translateX(0);}
25%{transform:translateX(-5px);}
75%{transform:translateX(5px);}
}

.spinner{
border:3px solid rgba(212,175,55,0.2);
border-top:3px solid #d4af37;
border-radius:50%;
width:20px;
height:20px;
margin:0 auto 8px;
animation:spin 1s linear infinite;
}

@keyframes spin{
to{transform:rotate(360deg);}
}

footer{
margin-top:40px;
padding:20px;
font-size:13px;
color:#ccc;
border-top:1px solid rgba(212,175,55,0.3);
}
</style>
</head>

<body>

<div id="splash">
<div class="splash-content">
<h1>UEC UNIVERSITY BUS SYSTEM</h1>
<p>Transportation Management Platform</p>
</div>
</div>

<div class="header">UNIVERSITY of East Capital</div>

<div class="card" id="loginCard">
<h3>Driver Login</h3>
<input type="text" id="driver" placeholder="Driver Name">
<input type="text" id="bus" placeholder="Bus Number">
<button onclick="startRoute()">Start Route</button>
</div>

<div class="card" id="scannerCard" style="display:none;">
<div id="summary"></div>
<div id="reader"></div>
<div id="counter">Passengers: 0</div>
<div id="statusBox">Ready to scan...</div>
<br>
<button onclick="closeRoute()">Close Route</button>
</div>

<footer>
Designed by UEC ICT Department<br>
Â© 2026 University of East Capital
</footer>

<script>
let driverName="";
let busNumber="";
let studentCount=0;
let qr=null;
let isScanning=false;

const beep = new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");

function startRoute(){
driverName=document.getElementById("driver").value;
busNumber=document.getElementById("bus").value;

if(!driverName||!busNumber){
alert("Enter Driver & Bus Number");
return;
}

let startTime=new Date().toLocaleTimeString();

document.getElementById("loginCard").style.display="none";
document.getElementById("scannerCard").style.display="block";

document.getElementById("summary").innerHTML=
"Driver: "+driverName+
"<br>Bus: "+busNumber+
"<br>Start Time: "+startTime;

initializeScanner();
}

/* ============================= */
/* SCANNER INITIALIZATION */
/* ============================= */

function initializeScanner(){

if(qr){
qr.clear().catch(()=>{});
}

qr = new Html5Qrcode("reader");

isScanning=true;

qr.start(
{facingMode:"environment"},
{fps:10,qrbox:250},
onScanSuccess
);

document.getElementById("statusBox").innerHTML="Ready to scan...";
}

/* ============================= */
/* ON QR SUCCESS */
/* ============================= */

function onScanSuccess(decodedText){

if(!isScanning) return;

isScanning=false;

/* FULL STOP CAMERA */
qr.stop().then(()=>{
showProcessingScreen();
sendData(decodedText);
});
}

/* ============================= */
/* PROCESSING SCREEN */
/* ============================= */

function showProcessingScreen(){

document.getElementById("reader").style.display="none";

let box=document.getElementById("statusBox");
box.className="processing";
box.innerHTML=`
<div class='spinner'></div>
<div>Processing on server...</div>
<div style="direction:rtl;margin-top:5px;">
Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…...
</div>
`;
}

/* ============================= */
/* SEND DATA */
/* ============================= */

function sendData(id){

fetch("https://script.google.com/macros/s/AKfycbzlT8RGcQtHVOWjshn1H5BZyi78B0DgUhtL4ahpS9JXlgTuKMjzSWcQVYm05AaIxx0KcQ/exec",{
method:"POST",
body:JSON.stringify({
id:id,
driver:driverName,
bus:busNumber
})
})
.then(res=>res.json())
.then(data=>{

let box=document.getElementById("statusBox");
let message="";

if(data.status==="approved"){
studentCount++;
document.getElementById("counter").innerText=
"Passengers: "+studentCount;

message=`
<div>âœ… ${data.name} Approved</div>
<div style="direction:rtl;margin-top:5px;">
ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­
</div>
`;

box.className="success";

beep.play();
if(navigator.vibrate) navigator.vibrate(150);
playVoice(data.name);
}
else if(data.status==="already_used"){
message=`
<div>âŒ Already Used</div>
<div style="direction:rtl;margin-top:5px;">
ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² Ù…Ù† Ù‚Ø¨Ù„
</div>
`;
box.className="error";
}
else if(data.status==="out_of_time"){
message=`
<div>â° Outside Allowed Time</div>
<div style="direction:rtl;margin-top:5px;">
Ø®Ø§Ø±Ø¬ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­
</div>
`;
box.className="error";
}
else{
message=`
<div>ğŸš« Not Registered</div>
<div style="direction:rtl;margin-top:5px;">
ØºÙŠØ± Ù…Ø³Ø¬Ù„ ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù…
</div>
`;
box.className="error";
}

box.innerHTML=message;

/* AFTER 2 SECONDS RESTART CAMERA CLEANLY */
setTimeout(()=>{
document.getElementById("reader").style.display="block";
initializeScanner();
},2000);

})
.catch(()=>{

let box=document.getElementById("statusBox");
box.className="error";
box.innerHTML=`
<div>âš  Network Error</div>
<div style="direction:rtl;margin-top:5px;">
Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ©
</div>
`;

setTimeout(()=>{
document.getElementById("reader").style.display="block";
initializeScanner();
},2000);

});
}

/* ============================= */
/* CLOSE ROUTE */
/* ============================= */

function closeRoute(){
if(qr){
qr.stop().then(()=>{
qr.clear();
});
}

document.getElementById("scannerCard").innerHTML=
"<h2 style='color:#d4af37'>Route Closed Successfully</h2>"+
"<p>Total Passengers: "+studentCount+"</p>";
}

/* ============================= */
/* VOICE */
/* ============================= */

function playVoice(name){
const msg=new SpeechSynthesisUtterance(
"Welcome "+name+". You are approved for boarding."
);
msg.lang="en-US";
msg.rate=0.9;
speechSynthesis.speak(msg);
}
</script>

</body>
</html>
