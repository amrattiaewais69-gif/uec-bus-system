<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>University Bus System</title>
<script src="https://unpkg.com/html5-qrcode"></script>
<style>
body{
margin:0;
font-family:Arial;
background:linear-gradient(135deg,#0a1931,#1f4068);
color:white;
text-align:center;
}
.card{
background:#162447;
margin:20px;
padding:20px;
border-radius:15px;
box-shadow:0 0 20px rgba(212,175,55,0.4);
}
button{
background:#d4af37;
border:none;
padding:12px 20px;
border-radius:8px;
cursor:pointer;
font-weight:bold;
}
input{
padding:10px;
margin:5px;
border-radius:6px;
border:none;
}
#counter{
color:#d4af37;
font-weight:bold;
margin-top:10px;
}
</style>
</head>
<body>

<h1>üöå University Bus System</h1>

<div class="card" id="loginCard">
<h2>Driver Login</h2>
<input type="text" id="driver" placeholder="Driver Name"><br>
<input type="text" id="bus" placeholder="Bus Number"><br>
<button onclick="startSystem()">Start Route</button>
</div>

<div class="card" id="scannerCard" style="display:none;">
<div id="reader"></div>
<div id="counter">Passengers: 0</div>
<p id="status"></p>
<button onclick="endRoute()">Close Route</button>
</div>

<script>
let driverName="";
let busNumber="";
let studentCount=0;
let qr;
let routeType="";

function startSystem(){
driverName=document.getElementById("driver").value;
busNumber=document.getElementById("bus").value;
if(!driverName||!busNumber){
alert("Enter Driver & Bus");
return;
}
document.getElementById("loginCard").style.display="none";
document.getElementById("scannerCard").style.display="block";

qr=new Html5Qrcode("reader");
qr.start({ facingMode:"environment" },
{ fps:10, qrbox:250 },
qrCodeMessage=>{
sendData(qrCodeMessage);
});
}

function sendData(id){
fetch("https://script.google.com/macros/s/AKfycbxt0Eem7RpP9DleKHXMyWF4MKU8A1XSL7d7vsn8BuWMJIGukvcIh3-0yzARnH5AyYlk8w/exec",{
method:"POST",
body:JSON.stringify({
id:id,
driver:driverName,
bus:busNumber
})
})
.then(res=>res.json())
.then(data=>{
let msg="";
if(data.status==="approved"){
studentCount++;
routeType=data.routeType;
document.getElementById("counter").innerText="Passengers: "+studentCount;
playSound();
msg="‚úÖ "+data.name+" - "+routeType;
}
else if(data.status==="already_used"){
msg="‚ùå Already Used";
}
else if(data.status==="out_of_time"){
msg="‚è∞ Out of Time";
}
else{
msg="üö´ Not Registered";
}
document.getElementById("status").innerText=msg;
});
}

function endRoute(){
if(qr){qr.stop();}
fetch("YOUR_WEB_APP_URL",{
method:"POST",
body:JSON.stringify({action:"close_route"})
});
document.getElementById("scannerCard").innerHTML="<h2>Route Closed Successfully</h2>";
}

function playSound(){
const audio=new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
audio.play();
}
</script>

</body>
</html>
